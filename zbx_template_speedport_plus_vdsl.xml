<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>7.0</version>
    <template_groups>
        <template_group>
            <uuid>36bff6c29af64692839d077febfc7079</uuid>
            <name>Templates/Network devices</name>
        </template_group>
    </template_groups>
    <templates>
        <template>
            <uuid>04a824e698c74fbb80d2f24f675884bd</uuid>
            <template>Speedport Plus VDSL HTTP JSON</template>
            <name>Speedport Plus VDSL HTTP JSON</name>
            <groups>
                <group>
                    <name>Templates/Network devices</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>5ad2413ed21a4c80b8788c013cc586c5</uuid>
                    <name>Device name</name>
                    <type>DEPENDENT</type>
                    <key>modem.device.name</key>
                    <delay>0</delay>
                    <value_type>TEXT</value_type>
                    <trends>0</trends>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;device_name&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1d</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>1b0cfe75a83c46738b4b97a7a8d17a1a</uuid>
                    <name>Attenuation downstream</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.attn.down</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>dB</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;vdsl_atnd&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1h</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>140d703c5b064e1fbb7f47f9557d5084</uuid>
                    <name>Attenuation upstream</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.attn.up</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>dB</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;vdsl_atnu&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1h</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>a2a26646bd4e4219a2bb095269e78452</uuid>
                    <name>CRC errors</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.crc</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;dsl_crc_errors&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>6d0232d3f8614e7e8863ab849bc382ec</uuid>
                    <name>CRC error rate</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.crc.per_hour</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>errors/h</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;dsl_crc_errors&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>CHANGE_PER_SECOND</type>
                            <parameters>
                                <parameter/>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>3600</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <uuid>9905df6437f54d6bb1e4ebd785457b08</uuid>
                            <expression>avg(/Speedport Plus VDSL HTTP JSON/modem.dsl.crc.per_hour,15m)&gt;{$CRC.RATE.WARN}</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>avg(/Speedport Plus VDSL HTTP JSON/modem.dsl.crc.per_hour,15m)&lt;{$CRC.RATE.WARN.RECOVER}</recovery_expression>
                            <name>CRC rate elevated: {ITEM.LASTVALUE1} events/h (avg 15m &gt; {$CRC.RATE.WARN})</name>
                            <priority>WARNING</priority>
                            <dependencies>
                                <dependency>
                                    <name>CRC rate HIGH: {ITEM.LASTVALUE1} events/h (avg 15m &gt; {$CRC.RATE.CRIT})</name>
                                    <expression>avg(/Speedport Plus VDSL HTTP JSON/modem.dsl.crc.per_hour,15m) &gt; {$CRC.RATE.CRIT}</expression>
                                    <recovery_expression>avg(/Speedport Plus VDSL HTTP JSON/modem.dsl.crc.per_hour,15m) &lt; {$CRC.RATE.CRIT.RECOVER}</recovery_expression>
                                </dependency>
                            </dependencies>
                        </trigger>
                        <trigger>
                            <uuid>436d0e19cad34c89a47086a5ca03093f</uuid>
                            <expression>avg(/Speedport Plus VDSL HTTP JSON/modem.dsl.crc.per_hour,15m) &gt; {$CRC.RATE.CRIT}</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>avg(/Speedport Plus VDSL HTTP JSON/modem.dsl.crc.per_hour,15m) &lt; {$CRC.RATE.CRIT.RECOVER}</recovery_expression>
                            <name>CRC rate HIGH: {ITEM.LASTVALUE1} events/h (avg 15m &gt; {$CRC.RATE.CRIT})</name>
                            <priority>HIGH</priority>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>e626047e1c43411aafa25c0a0bba556d</uuid>
                    <name>DSL downstream</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.down</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>Mbps</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;dsl_downstream&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>0.001</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>15m</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>b9935522bca04f4486f414e8d123e506</uuid>
                    <name>FEC errors</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.fec</key>
                    <delay>0</delay>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;dsl_fec_errors&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>fbaa99e4ddf44a70b9fe7e173940196e</uuid>
                    <name>DSL max downstream</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.max_down</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>Mbps</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;dsl_max_downstream&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>0.001</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1h</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>8856c3f923764782a3bcd0d5b532356d</uuid>
                    <name>DSL max upstream</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.max_up</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>Mbps</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;dsl_max_upstream&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>0.001</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1h</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>9dc7c5de96f8468a8112ea99f9c7700f</uuid>
                    <name>DSL online time</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.online.string</key>
                    <delay>0</delay>
                    <value_type>TEXT</value_type>
                    <trends>0</trends>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;dsl_online_time&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1d</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>87984c1698ef48c481cf9b2f32950361</uuid>
                    <name>DSL profile</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.profile</key>
                    <delay>0</delay>
                    <value_type>TEXT</value_type>
                    <trends>0</trends>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;dsl_transmission_mode&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1d</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>607f7f56e82946b89ce098e218040c4e</uuid>
                    <name>SNR margin downstream</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.snr.down</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>dB</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;dsl_snr&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>REGEX</type>
                            <parameters>
                                <parameter>([0-9.]+)\s*/\s*([0-9.]+)</parameter>
                                <parameter>\1</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <uuid>ad6fcdbe4c19481dbc64a040af9640b8</uuid>
                            <expression>last(/Speedport Plus VDSL HTTP JSON/modem.dsl.snr.down)&lt;{$SNR.DOWN.MIN}</expression>
                            <name>Low downstream SNR</name>
                            <priority>WARNING</priority>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>c101841630bc4c75af610dde7d2d4101</uuid>
                    <name>SNR margin upstream</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.snr.up</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>dB</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;dsl_snr&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>REGEX</type>
                            <parameters>
                                <parameter>([0-9.]+)\s*/\s*([0-9.]+)</parameter>
                                <parameter>\2</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>066075e1e04347df8b6571079d9e9af9</uuid>
                    <name>DSL status</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.status</key>
                    <delay>0</delay>
                    <value_type>TEXT</value_type>
                    <trends>0</trends>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;dsl_status&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1h</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <uuid>d349bd82727f42479bcd1202b7288cfe</uuid>
                            <expression>last(/Speedport Plus VDSL HTTP JSON/modem.dsl.status)&lt;&gt;&quot;online&quot;</expression>
                            <name>DSL is DOWN</name>
                            <priority>HIGH</priority>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>9d90c3729e31417584bfd13be6fad4c5</uuid>
                    <name>DSL Link sync time</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.sync.time.string</key>
                    <delay>0</delay>
                    <value_type>TEXT</value_type>
                    <trends>0</trends>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;dsl_sync_time&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1d</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>8001c36fa87f48dcac0423c69e4b2052</uuid>
                    <name>DSL upstream</name>
                    <type>DEPENDENT</type>
                    <key>modem.dsl.up</key>
                    <delay>0</delay>
                    <value_type>FLOAT</value_type>
                    <units>Mbps</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;dsl_upstream&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>MULTIPLIER</type>
                            <parameters>
                                <parameter>0.001</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>15m</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>5a22fa71461542018041cd997d2bda03</uuid>
                    <name>Firmware version</name>
                    <type>DEPENDENT</type>
                    <key>modem.firmware.version</key>
                    <delay>0</delay>
                    <value_type>TEXT</value_type>
                    <trends>0</trends>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;firmware_version&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <parameters>
                                <parameter>1d</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                    <triggers>
                        <trigger>
                            <uuid>a4e51d09d9c949e4b5c6e4b76a901236</uuid>
                            <expression>last(/Speedport Plus VDSL HTTP JSON/modem.firmware.version,#1)&lt;&gt;last(/Speedport Plus VDSL HTTP JSON/modem.firmware.version,#2) and length(last(/Speedport Plus VDSL HTTP JSON/modem.firmware.version))&gt;0</expression>
                            <name>Firmware changed (current: {ITEM.VALUE})</name>
                            <priority>INFO</priority>
                            <manual_close>YES</manual_close>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>7b24024de03f4eeaa37eea17c9675171</uuid>
                    <name>Router uptime (seconds)</name>
                    <type>DEPENDENT</type>
                    <key>modem.router.uptime.seconds</key>
                    <delay>0</delay>
                    <units>s</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;uptime&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>JAVASCRIPT</type>
                            <parameters>
                                <parameter>// Parse strings like &quot;28 days, 23 hours, 59 minutes, 15 seconds&quot;
var s = value.toLowerCase();
var d = 0;
function grab(re){ var m = s.match(re); return m ? parseInt(m[1],10) : 0; }
d += grab(/(\d+)\s*day/);
d = d*24 + grab(/(\d+)\s*hour/);
d = d*60 + grab(/(\d+)\s*minute/);
d = d*60 + grab(/(\d+)\s*second/);
return d;</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>7b82ef69e3e0423ba00fad7a12509a55</uuid>
                    <name>uptime</name>
                    <type>DEPENDENT</type>
                    <key>modem.router.uptime.string</key>
                    <delay>0</delay>
                    <units>s</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$[?(@.varid==&quot;uptime&quot;)].varvalue.first()</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>JAVASCRIPT</type>
                            <parameters>
                                <parameter>// E.g. &quot;29 days, 0 hours, 1 minutes, 21 seconds&quot;
var s = value.toLowerCase();
function pick(rx){ var m = s.match(rx); return m ? parseInt(m[1],10) : 0; }
var days = pick(/(\d+)\s*day/);
var hrs  = pick(/(\d+)\s*hour/);
var min  = pick(/(\d+)\s*minute/);
var sec  = pick(/(\d+)\s*second/);
return (((days*24 + hrs)*60 + min)*60 + sec);</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>modem.status.json</key>
                    </master_item>
                </item>
                <item>
                    <uuid>de3a5fc159d949139d4a1d35e9800169</uuid>
                    <name>Status.json (raw)</name>
                    <type>HTTP_AGENT</type>
                    <key>modem.status.json</key>
                    <value_type>TEXT</value_type>
                    <trends>0</trends>
                    <url>{$MODEM.URL}</url>
                    <headers>
                        <header>
                            <name>user-Agent</name>
                            <value>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/132.0.0.0 Safari/537.36</value>
                        </header>
                        <header>
                            <name>accept</name>
                            <value>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</value>
                        </header>
                        <header>
                            <name>accept-Encoding</name>
                            <value>identity</value>
                        </header>
                        <header>
                            <name>accept-language</name>
                            <value>en-US,en;q=0.9,el;q=0.8</value>
                        </header>
                        <header>
                            <name>connection</name>
                            <value>close</value>
                        </header>
                    </headers>
                </item>
            </items>
            <macros>
                <macro>
                    <macro>{$ATTAIN.MARGIN}</macro>
                    <value>1.05</value>
                    <description>Sync-to-max margin</description>
                </macro>
                <macro>
                    <macro>{$CRC.RATE.CRIT}</macro>
                    <value>1800</value>
                </macro>
                <macro>
                    <macro>{$CRC.RATE.CRIT.RECOVER}</macro>
                    <value>1200</value>
                </macro>
                <macro>
                    <macro>{$CRC.RATE.WARN}</macro>
                    <value>360</value>
                    <description>CRC/hour warning</description>
                </macro>
                <macro>
                    <macro>{$CRC.RATE.WARN.RECOVER}</macro>
                    <value>240</value>
                </macro>
                <macro>
                    <macro>{$MODEM.URL}</macro>
                    <value>http://192.168.0.1/data/Status.json</value>
                    <description>Modem URL</description>
                </macro>
                <macro>
                    <macro>{$SNR.DOWN.MIN}</macro>
                    <value>6</value>
                    <description>Min downstream SNR dB</description>
                </macro>
                <macro>
                    <macro>{$SNR.UP.MIN}</macro>
                    <value>6</value>
                    <description>Min upstream SNR dB</description>
                </macro>
            </macros>
        </template>
    </templates>
    <triggers>
        <trigger>
            <uuid>d7603f095ccc44ef9e27a20fba186f0a</uuid>
            <expression>last(/Speedport Plus VDSL HTTP JSON/modem.dsl.down)&gt;last(/Speedport Plus VDSL HTTP JSON/modem.dsl.max_down)*{$ATTAIN.MARGIN}</expression>
            <name>Sync &gt; attainable</name>
            <priority>INFO</priority>
        </trigger>
    </triggers>
</zabbix_export>
